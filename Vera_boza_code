{"cells":[{"cell_type":"code","execution_count":141,"metadata":{"executionInfo":{"elapsed":3,"status":"ok","timestamp":1766185302394,"user":{"displayName":"–ë–æ–≥–¥–∞–Ω –ó–∞—Ä–∏–ø–æ–≤","userId":"12865476929575154304"},"user_tz":480},"id":"ZcvSDDaeQsyq"},"outputs":[],"source":["import json\n","import torchvision\n","from torchvision import models\n","import torch\n","import torch.nn as nn\n","from torch.utils.data import DataLoader, TensorDataset, random_split\n","from torchvision import datasets\n","from torchvision import transforms as T\n","from PIL import Image\n","import os\n","import pandas as pd\n","import numpy as np\n","\n","import rasterio\n","from rasterio.plot import reshape_as_image"]},{"cell_type":"code","source":["class TransferLearningModel(nn.Module):\n","        def __init__(self, num_classes=10, pretrained=True):\n","            super().__init__()\n","\n","            # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å\n","            from torchvision import models\n","            backbone = models.resnet18(pretrained=pretrained)\n","\n","            # –ó–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ–º –≤–µ—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)\n","            # for param in backbone.parameters():\n","            #     param.requires_grad = False\n","\n","            # –ó–∞–º–µ–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–æ–π\n","            num_features = backbone.fc.in_features\n","            backbone.fc = nn.Linear(num_features, num_classes)\n","\n","            self.model = backbone\n","\n","        def forward(self, x):\n","            return self.model(x)"],"metadata":{"id":"gVSPdZhxm8C2","executionInfo":{"status":"ok","timestamp":1766181292615,"user_tz":480,"elapsed":41,"user":{"displayName":"–ë–æ–≥–¥–∞–Ω –ó–∞—Ä–∏–ø–æ–≤","userId":"12865476929575154304"}}},"execution_count":117,"outputs":[]},{"cell_type":"code","source":["trainable_params = sum(p.numel() for p in model.parameters() if p.requires_grad)\n","total_params = sum(p.numel() for p in model.parameters())\n","print(f\"–û–±—É—á–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: {trainable_params / 1e6:.2f}M / {total_params / 1e6:.2f}M\")\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"7lCAsuasjwJk","executionInfo":{"status":"ok","timestamp":1766180469738,"user_tz":480,"elapsed":11,"user":{"displayName":"–ë–æ–≥–¥–∞–Ω –ó–∞—Ä–∏–ø–æ–≤","userId":"12865476929575154304"}},"outputId":"1c97f3a6-fd8f-45a0-a6e0-b1d2c78dd359"},"execution_count":109,"outputs":[{"output_type":"stream","name":"stdout","text":["–û–±—É—á–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: 0.01M / 11.18M\n"]}]},{"cell_type":"markdown","source":["@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"],"metadata":{"id":"04m0FwOY1m8x"}},{"cell_type":"code","source":["os.environ[\"KAGGLEHUB_CACHE\"] = \"/tmp/kagglehub_new\"\n","\n","path = kagglehub.dataset_download(\"apollo2506/eurosat-dataset\")\n","print(\"–ù–æ–≤—ã–π –ø—É—Ç—å:\", path)\n","!ls \"{path}\""],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"n6I6Ncnb1jYK","executionInfo":{"status":"ok","timestamp":1766185245913,"user_tz":480,"elapsed":1705,"user":{"displayName":"–ë–æ–≥–¥–∞–Ω –ó–∞—Ä–∏–ø–æ–≤","userId":"12865476929575154304"}},"outputId":"88935fca-b1c2-4b30-ffdc-9aa7d5bccd5f"},"execution_count":139,"outputs":[{"output_type":"stream","name":"stdout","text":["Using Colab cache for faster access to the 'eurosat-dataset' dataset.\n","–ù–æ–≤—ã–π –ø—É—Ç—å: /kaggle/input/eurosat-dataset\n","EuroSAT  EuroSATallBands\n"]}]},{"cell_type":"code","source":["images_root = os.path.join(path, \"EuroSAT\")\n","train_transform = transforms.Compose([\n","    transforms.RandomRotation(10),\n","    transforms.RandomHorizontalFlip(p=.5),\n","    transforms.RandomCrop(32, padding=4),\n","    transforms.ToTensor(),\n","    transforms.Normalize(mean=[0.5, 0.5, 0.5], std=[0.5, 0.5, 0.5]),\n","    transforms.ColorJitter(brightness=.1, contrast=.5, saturation=.5, hue=.05)\n","])\n","\n","transform = transforms.Compose([\n","    transforms.Resize((64, 64)),\n","    transforms.ToTensor(),\n","    transforms.Normalize(mean=[0.5, 0.5, 0.5], std=[0.5, 0.5, 0.5])\n","])\n","\n","full_dataset = datasets.ImageFolder(root=images_root, transform=transform)\n","\n","n = len(full_dataset)\n","train_size = int(0.7 * n)\n","val_size = int(0.15 * n)\n","test_size = n - train_size - val_size\n","\n","train_dataset, val_dataset, test_dataset = random_split(\n","    full_dataset, [train_size, val_size, test_size]\n",")\n","\n","print(\"‚úÖ –î–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã!\")\n","print(\"Train:\", len(train_dataset))\n","print(\"Val:\", len(val_dataset))\n","print(\"Test:\", len(test_dataset))\n","print(\"–ö–ª–∞—Å—Å—ã:\", full_dataset.classes)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"nEKizC1F1h2s","executionInfo":{"status":"ok","timestamp":1766186599196,"user_tz":480,"elapsed":5123,"user":{"displayName":"–ë–æ–≥–¥–∞–Ω –ó–∞—Ä–∏–ø–æ–≤","userId":"12865476929575154304"}},"outputId":"bbca5e88-87d0-482b-f2c1-595893bcaf16"},"execution_count":158,"outputs":[{"output_type":"stream","name":"stdout","text":["‚úÖ –î–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã!\n","Train: 18900\n","Val: 4050\n","Test: 4050\n","–ö–ª–∞—Å—Å—ã: ['AnnualCrop', 'Forest', 'HerbaceousVegetation', 'Highway', 'Industrial', 'Pasture', 'PermanentCrop', 'Residential', 'River', 'SeaLake']\n"]}]},{"cell_type":"code","source":["BATCH_SIZE = 128\n","\n","train_loader = DataLoader(train_dataset, batch_size=BATCH_SIZE, shuffle=True, num_workers=2)\n","val_loader = DataLoader(val_dataset, batch_size=BATCH_SIZE, shuffle=False, num_workers=2)\n","test_loader = DataLoader(test_dataset, batch_size=BATCH_SIZE, shuffle=False, num_workers=2)"],"metadata":{"id":"pS4mZ_Qs1h05","executionInfo":{"status":"ok","timestamp":1766186616948,"user_tz":480,"elapsed":5,"user":{"displayName":"–ë–æ–≥–¥–∞–Ω –ó–∞—Ä–∏–ø–æ–≤","userId":"12865476929575154304"}}},"execution_count":159,"outputs":[]},{"cell_type":"code","source":["device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n","\n","model = models.resnet18(weights=models.ResNet18_Weights.IMAGENET1K_V1)\n","\n","for param in model.parameters():\n","    param.requires_grad = False\n","\n","model.fc = nn.Linear(model.fc.in_features, 10)\n","\n","model = model.to(device)\n","print(\"–ú–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞!\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"0TvHA7jj1hxK","executionInfo":{"status":"ok","timestamp":1766186618253,"user_tz":480,"elapsed":196,"user":{"displayName":"–ë–æ–≥–¥–∞–Ω –ó–∞—Ä–∏–ø–æ–≤","userId":"12865476929575154304"}},"outputId":"8bdaacd5-6b5a-42a9-9781-0008408e8402"},"execution_count":160,"outputs":[{"output_type":"stream","name":"stdout","text":["–ú–æ–¥–µ–ª—å –≥–æ—Ç–æ–≤–∞!\n"]}]},{"cell_type":"code","source":["criterion = nn.CrossEntropyLoss()\n","optimizer = torch.optim.Adam(model.fc.parameters(), lr=1e-3)"],"metadata":{"id":"TPQP9cQ91hns","executionInfo":{"status":"ok","timestamp":1766186619609,"user_tz":480,"elapsed":4,"user":{"displayName":"–ë–æ–≥–¥–∞–Ω –ó–∞—Ä–∏–ø–æ–≤","userId":"12865476929575154304"}}},"execution_count":161,"outputs":[]},{"cell_type":"code","source":["EPOCHS = 7\n","for epoch in range(EPOCHS):\n","    model.train()\n","    running_loss = 0.0\n","    correct_train = 0\n","    total_train = 0\n","\n","    for images, labels in train_loader:\n","        images, labels = images.to(device), labels.to(device)\n","        optimizer.zero_grad()\n","        outputs = model(images)\n","        loss = criterion(outputs, labels)\n","        loss.backward()\n","        optimizer.step()\n","\n","        running_loss += loss.item()\n","        _, predicted = torch.max(outputs, 1)\n","        total_train += labels.size(0)\n","        correct_train += (predicted == labels).sum().item()\n","\n","    train_acc = 100 * correct_train / total_train\n","    # –í–∞–ª–∏–¥–∞—Ü–∏—è\n","    model.eval()\n","    correct_val = 0\n","    total_val = 0\n","    with torch.no_grad():\n","        for images, labels in val_loader:\n","            images, labels = images.to(device), labels.to(device)\n","            outputs = model(images)\n","            _, predicted = torch.max(outputs, 1)\n","            total_val += labels.size(0)\n","            correct_val += (predicted == labels).sum().item()\n","    val_acc = 100 * correct_val / total_val\n","\n","    print(f\"Epoch {epoch+1}/{EPOCHS} | Train Acc: {train_acc:.2f}% | Val Acc: {val_acc:.2f}%\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"7Oev_4Xe2eHn","executionInfo":{"status":"ok","timestamp":1766186742326,"user_tz":480,"elapsed":118204,"user":{"displayName":"–ë–æ–≥–¥–∞–Ω –ó–∞—Ä–∏–ø–æ–≤","userId":"12865476929575154304"}},"outputId":"b21adc87-36f0-42ca-bd78-e3226d8303a8"},"execution_count":162,"outputs":[{"output_type":"stream","name":"stdout","text":["Epoch 1/7 | Train Acc: 70.46% | Val Acc: 82.77%\n","Epoch 2/7 | Train Acc: 83.13% | Val Acc: 84.20%\n","Epoch 3/7 | Train Acc: 84.90% | Val Acc: 85.26%\n","Epoch 4/7 | Train Acc: 85.68% | Val Acc: 84.74%\n","Epoch 5/7 | Train Acc: 86.32% | Val Acc: 85.58%\n","Epoch 6/7 | Train Acc: 86.60% | Val Acc: 86.05%\n","Epoch 7/7 | Train Acc: 86.74% | Val Acc: 85.70%\n"]}]},{"cell_type":"code","source":["model.eval()\n","correct_test = 0\n","total_test = 0\n","with torch.no_grad():\n","    for images, labels in test_loader:\n","        images, labels = images.to(device), labels.to(device)\n","        outputs = model(images)\n","        _, predicted = torch.max(outputs, 1)\n","        total_test += labels.size(0)\n","        correct_test += (predicted == labels).sum().item()\n","\n","test_acc = 100 * correct_test / total_test\n","print(f\"\\nüéØ –¢–µ—Å—Ç–æ–≤–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å: {test_acc:.2f}%\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"rWoBDd1L2eFT","executionInfo":{"status":"ok","timestamp":1766186774893,"user_tz":480,"elapsed":3073,"user":{"displayName":"–ë–æ–≥–¥–∞–Ω –ó–∞—Ä–∏–ø–æ–≤","userId":"12865476929575154304"}},"outputId":"c41f498a-b66e-42a8-cf2c-a0722e3aa3be"},"execution_count":163,"outputs":[{"output_type":"stream","name":"stdout","text":["\n","üéØ –¢–µ—Å—Ç–æ–≤–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å: 87.09%\n"]}]},{"cell_type":"code","source":["torch.save(model.state_dict(), \"/content/eurosat_resnet180.pth\")  # –ü—Ä–∏–º–µ—Ä –¥–ª—è Google Colab\n","print(\"‚úÖ –ú–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∫–∞–∫ 'eurosat_resnet180.pth'\")\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"dPkui3sh2eDE","executionInfo":{"status":"ok","timestamp":1766186843821,"user_tz":480,"elapsed":91,"user":{"displayName":"–ë–æ–≥–¥–∞–Ω –ó–∞—Ä–∏–ø–æ–≤","userId":"12865476929575154304"}},"outputId":"fd123e7a-2866-47dc-9d84-c5d85dca0eaf"},"execution_count":164,"outputs":[{"output_type":"stream","name":"stdout","text":["‚úÖ –ú–æ–¥–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∫–∞–∫ 'eurosat_resnet180.pth'\n"]}]},{"cell_type":"code","source":[],"metadata":{"id":"5OzgixzM4j15"},"execution_count":null,"outputs":[]}],"metadata":{"accelerator":"GPU","colab":{"gpuType":"T4","provenance":[{"file_id":"17dtD890cINprPA0lAidhOPgFPGUkiqVs","timestamp":1766187110311}],"mount_file_id":"17dtD890cINprPA0lAidhOPgFPGUkiqVs","authorship_tag":"ABX9TyNlDhNom1fCCrRIPVuOWKhJ"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}